<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toggle Controller</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">

    <style>
        * {
            overflow: hidden;
        }
    </style>
</head>
<body>


    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <h1>Praiser</h1>
                <button class="btn btn-success" onclick="sendMessage('show', 'praiser')">إظهار</button>
                <button class="btn btn-danger" onclick="sendMessage('hide', 'praiser')">إخفاء</button>
                <button class="btn btn-warning" onclick="sendMessage('toggle', 'praiser')">إظهار/ إخفاء</button>

                <h1>Preacher</h1>

                <button class="btn btn-success" onclick="sendMessage('show', 'preacher')">إظهار</button>
                <button class="btn btn-danger" onclick="sendMessage('hide', 'preacher')">إخفاء</button>
                <button class="btn btn-warning" onclick="sendMessage('toggle', 'preacher')">إظهار/ إخفاء</button>
            </div>
            <div class="col-md-6">
            <form dir="rtl" id="serviceForm" onsubmit="updateInofmation">
                <h2>معلومات الخدمة</h2>
                <input type="text" name="praiserName" id="praiserName" placeholder="إسم قائد التسبيح" />
                <br />
                <br />
                <input type="text" name="praiserGroupTitle" id="praiserGroupTitle" placeholder="فريق التسبيح" />
                <hr />
                <input type="text" name="preacherName" id="preacherName" placeholder="إسم الخادم" />
                <br />
                <br />
                <input type="text" name="preacherGroupTitle" id="preacherGroupTitle" placeholder="كنيسة الخادم"  />
                <br />
                <br />
                <button class="btn btn-success" type="submit">تسجيل</button>
            </form>
            </div>
        </div>

        <hr  />

        <div class="row">
            <div class="col-12">
                <iframe width="1920" height="1080" style="transform: scale(.6);transform-origin: 0 0;overflow: hidden;" src="lower-third-names.html"></iframe>
            </div>
        </div>


    </div>

    <script>
        const ws = new WebSocket("ws://localhost:8082")

        let isDisplayed = false;

        ws.addEventListener("open" , () => {
            console.log('We are connected')
        })

        const sendMessage = (displayType = 'show' , viewType = 'praiser') => {

            const requestToSend = {
                viewType
            }

            switch(displayType){
                case 'show':
                    if(isDisplayed) return
                    isDisplayed = true;
                    requestToSend.requestType = 'show'
                break;
                case 'hide':
                    if(!isDisplayed) return
                    isDisplayed = false;
                    requestToSend.requestType = 'hide'
                break;
                case 'toggle':
                    isDisplayed = !isDisplayed;
                    requestToSend.requestType = (isDisplayed) ? 'show' : 'hide'
                break;
                default:
                    return false;
                break;
            }

            ws.send(JSON.stringify(requestToSend))
        }

        ws.addEventListener("message", e => {
                const data =  JSON.parse(e.data);
                const action = data.type

                if(action === 'recent-service-information'){
                    document.getElementById("praiserName").value = data.data.praiser.name;
                    document.getElementById("praiserGroupTitle").value = data.data.praiser.group;
                    document.getElementById("preacherName").value = data.data.preacher.name;
                    document.getElementById("preacherGroupTitle").value = data.data.preacher.group;
                }
        })


        document.getElementById("serviceForm").addEventListener("submit", function(event) {
          event.preventDefault(); // Prevent the default form submission behavior

          const praiserName = document.getElementById("praiserName").value;
          const praiserGroupTitle = document.getElementById("praiserGroupTitle").value;
          const preacherName = document.getElementById("preacherName").value;
          const preacherGroupTitle = document.getElementById("preacherGroupTitle").value;

          ws.send(JSON.stringify({
            requestType: 'update-information',
            praiserName,
            praiserGroupTitle,
            preacherName,
            preacherGroupTitle
          }))
        });

    </script>
</body>
</html>
